---
title: "Docker Compose ã® YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ¼ã‚¸/ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["docker"]
published: true
---

## TLDR;

- æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§è¤‡æ•°ã® `compose.yaml` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ¼ã‚¸/ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰

  ```shell
  docker compose -f compose.yaml -f compose.override.yaml up -d
  ```

- `compose.override.yaml` ã§è¨­å®šã‚’å‰Šé™¤ã™ã‚‹å ´åˆã€YAML ã® `!reset` ã‚¿ã‚°ã‚’ä½¿ã†

  ä¾‹:

  ```yaml
  services:
    web:
      image: nginx
      ports: !reset []
  ```

- `compose.override.yaml` ã§è¨­å®šã‚’ä¸Šæ›¸ãã™ã‚‹å ´åˆã€YAML ã® `!override` ã‚¿ã‚°ã‚’ä½¿ã†

  ä¾‹:

  ```yaml
  services:
    web:
      ports: !override
        - "18080:80"
  ```

## æ¦‚è¦

Docker Compose ã§è¤‡æ•°ã® `compose.yaml`
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ¼ã‚¸/ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## `docker compose` ã‚³ãƒãƒ³ãƒ‰ã® `-f/--file` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†

`docker compose` ã‚³ãƒãƒ³ãƒ‰ã«ã¯ `-f/--file` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€è¤‡æ•°ã®
`compose.yaml` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

```shell
docker compose -f compose.yaml -f compose.override.yaml up -d
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã®å ´åˆã€ `compose.yaml` ã« `compose.override.yaml`
ã®å†…å®¹ãŒãƒãƒ¼ã‚¸ã•ã‚ŒãŸå†…å®¹ã§ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã•ã‚Œã¾ã™ã€‚

é–‹ç™º/æœ¬ç•ªç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆã‚„ã€æ—¢å­˜ã® `compose.yaml`
ã«æ–°ã—ã„è¨­å®šã‚’è¿½åŠ ã™ã‚‹éš›ã«ä¾¿åˆ©ã§ã™ã€‚

ãƒãƒ¼ã‚¸ã•ã‚ŒãŸå†…å®¹ã¯ `docker compose config` ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™ã€‚

```shell
docker compose -f compose.yaml -f compose.override.yaml config
```

## è¨­å®šã®å‰Šé™¤

ä¸Šè¨˜ã® `compose.override.yaml` ã§è¨­å®šã‚’å‰Šé™¤ã™ã‚‹å ´åˆã€YAML ã® `!reset`
ã‚¿ã‚°ã‚’ä½¿ã†ã“ã¨ã§å‰Šé™¤ã§ãã¾ã™ã€‚

`compose.yaml`

```yaml
services:
  web:
    image: nginx
    ports:
      - "8080:80"
```

---

`compose.override.yaml`

```yaml
services:
  web:
    ports: !reset []
```

ã“ã®å ´åˆã€ `compose.override.yaml` ã§ `ports` ã®è¨­å®šã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™ã€‚

## è¨­å®šã®ä¸Šæ›¸ã

ä¸Šè¨˜ã® `compose.override.yaml` ã§è¨­å®šã‚’ä¸Šæ›¸ãã™ã‚‹å ´åˆã€ YAML ã® `!override`
ã‚¿ã‚°ã‚’ä½¿ã†ã“ã¨ã§ä¸Šæ›¸ãã§ãã¾ã™ã€‚

`compose.yaml`

```yaml
services:
  web:
    image: nginx
    ports:
      - "8080:80"
```

`compose.override.yaml`

```yaml
services:
  web:
    ports: !override
      - "18080:80"
```

`!override` ã‚¿ã‚°ã‚’ä»˜ä¸ã—ãªã„ã¨ã€ `ports`
ã®è¨­å®šãŒãƒãƒ¼ã‚¸ã•ã‚Œã¦ã—ã¾ã„ã€æ¬¡ã®ã‚ˆã†ãªå†…å®¹ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

```yaml
services:
  web:
    image: nginx
    ports:
      - "8080:80"
      - "18080:80"
```

`!override` ã‚¿ã‚°ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ã€ `ports` ã®è¨­å®šãŒä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚

## å‚è€ƒ

https://docs.docker.com/compose/how-tos/multiple-compose-files/merge/

https://docs.docker.com/reference/compose-file/merge/
